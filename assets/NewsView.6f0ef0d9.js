import{r as x,o as u,c,a as l,w as s,V as m,bf as g,S as f,d as r,L as p,Z as h,g as o,F as j,e as z,bd as F,h as T,l as U,t as b,s as A,m as N,X as S,W as _,i as $,k}from"./index.29086af8.js";import{V as B}from"./VDialog.d3018f93.js";import{V as D}from"./VTable.5006d391.js";import{V as E}from"./VForm.e9b6ebf5.js";import{a as q}from"./VTextField.125602e1.js";import{V as L}from"./VCheckbox.2a222805.js";import{V as M,a as P}from"./VTextarea.1205a4b8.js";import"./scopeId.9e4356b5.js";import"./easing.1a8f6470.js";import"./form.dbdfce03.js";import"./VOverlay.cbcff291.js";import"./VCheckboxBtn.56eed043.js";const R={id:"admin-news"},W=o("h1",{class:"text-center my-2"},"\u6D88\u606F\u7BA1\u7406",-1),X=_("mdi-plus"),Z=o("thead",null,[o("tr",null,[o("th",{class:"text-center text-h6"},"\u7DE8\u865F"),o("th",{class:"text-center text-h6"},"\u5716\u7247"),o("th",{class:"text-center text-h6"},"\u6A19\u984C"),o("th",{class:"text-center text-h6"},"\u767C\u4F48"),o("th",{class:"text-center text-h6"},"\u7DE8\u8F2F"),o("th",{class:"text-center text-h6"},"\u522A\u9664")])],-1),G={class:"text-center"},H={class:"text-center"},J={key:0,class:"text-center"},K={key:1,class:"text-center"},O=_("mdi-pencil-outline"),Q=_("mdi-delete"),Y={key:1},I=o("td",{class:"text-center text-h6",colspan:"6"},"\u5C1A\u7121\u6D88\u606F",-1),ee=[I],te=_("mdi-close"),le={class:"text-h5"},se=_("\u78BA\u5B9A"),ie=_("\u53D6\u6D88"),xe={__name:"NewsView",setup(ae){const n=x([]),t=x({_id:"",title:"",publish:!1,description:"",image:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),y=(a,e)=>{t._id=a,e>-1?(t.title=n[e].title,t.publish=n[e].publish,t.description=n[e].description):(t.title="",t.publish=!1,t.description=""),t.image=[],t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},V=x({required(a){return!!a||"\u5FC5\u586B"},size(a){var e,i,d;return!a||!a.length||((i=(e=a[0])==null?void 0:e.type)==null?void 0:i.includes("image"))&&((d=a[0])==null?void 0:d.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),v=async()=>{if(!t.valid)return;t.submitting=!0;const a=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||(e==="image"?a.append(e,t[e][0]):a.append(e,t[e]));try{if(t._id.length===0){const{data:e}=await g.post("/news",a);n.push(e.result),f.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await g.patch("/news/"+t._id,a);console.log(a.name),n[t.idx]=e.result,f.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){f.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1},w=async(a,e)=>{try{if(a.length!==0){const{data:i}=await g.delete("/news/"+a);n.splice(e,1),f.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"})}}catch(i){f.fire({icon:"error",title:"\u5931\u6557",text:i.isAxiosError?i.response.data.message:i.message})}};return(async()=>{try{const{data:a}=await g.get("/news/all");n.push(...a.result)}catch(a){console.log(a),f.fire({icon:"error",title:"\u5931\u6557",text:a.isAxiosError?a.response.data.message:a.message})}})(),(a,e)=>(u(),c("div",R,[l(m,{class:"justify-center"},{default:s(()=>[l(r,{cols:"9"},{default:s(()=>[W]),_:1}),l(r,{cols:"9"},{default:s(()=>[l(m,{class:"justify-end align-center",style:{height:"150px"}},{default:s(()=>[l(p,{icon:"",variant:"text",onClick:e[0]||(e[0]=i=>y("",-1))},{default:s(()=>[l(h,{color:"green lighten-2"},{default:s(()=>[X]),_:1})]),_:1})]),_:1})]),_:1}),l(r,{cols:"9"},{default:s(()=>[l(D,null,{default:s(()=>[Z,o("tbody",null,[n.length>0?(u(!0),c(j,{key:0},z(n,(i,d)=>(u(),c("tr",{key:i._id},[o("td",G,b(d+1),1),o("td",null,[l($,{src:i.image},null,8,["src"])]),o("td",H,b(i.title),1),i.publish===!0?(u(),c("td",J,"\u5DF2\u767C\u4F48")):k("",!0),i.publish===!1?(u(),c("td",K,"\u672A\u767C\u4F48")):k("",!0),o("td",null,[l(m,{class:"justify-center"},{default:s(()=>[l(p,{onClick:C=>y(i._id,d),style:{width:"2rem",height:"2rem"},icon:"",variant:"text"},{default:s(()=>[l(h,{style:{"font-size":"large"},color:"blue lighten-2"},{default:s(()=>[O]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),o("td",null,[l(m,{class:"justify-center align-center"},{default:s(()=>[l(p,{onClick:C=>w(i._id,d),style:{width:"2rem",height:"2rem"},icon:"",variant:"text"},{default:s(()=>[l(h,{style:{"font-size":"large"},color:"red lighten-2"},{default:s(()=>[Q]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]))),128)):(u(),c("tr",Y,ee))])]),_:1})]),_:1})]),_:1}),l(B,{modelValue:t.dialog,"onUpdate:modelValue":e[8]||(e[8]=i=>t.dialog=i),persistent:""},{default:s(()=>[l(E,{class:"overflow-auto",modelValue:t.valid,"onUpdate:modelValue":e[7]||(e[7]=i=>t.valid=i),onSubmit:F(v,["prevent"])},{default:s(()=>[l(T,null,{default:s(()=>[l(r,{class:"d-flex justify-end"},{default:s(()=>[l(p,{icon:"",variant:"text",size:"x-small",onClick:e[1]||(e[1]=i=>t.dialog=!1)},{default:s(()=>[l(h,null,{default:s(()=>[te]),_:1})]),_:1})]),_:1}),l(U,{class:"text-center my-4"},{default:s(()=>[o("div",le,b(t._id.length>0?"\u7DE8\u8F2F\u6D88\u606F":"\u65B0\u589E\u6D88\u606F"),1)]),_:1}),l(A,null,{default:s(()=>[l(N,null,{default:s(()=>[l(m,{class:"justify-center"},{default:s(()=>[l(r,{cols:"9"},{default:s(()=>[l(q,{modelValue:t.title,"onUpdate:modelValue":e[2]||(e[2]=i=>t.title=i),label:"\u6A19\u984C",rules:[V.required]},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"9"},{default:s(()=>[l(L,{modelValue:t.publish,"onUpdate:modelValue":e[3]||(e[3]=i=>t.publish=i),label:"\u767C\u4F48"},null,8,["modelValue"])]),_:1}),l(r,{cols:"9"},{default:s(()=>[l(M,{modelValue:t.description,"onUpdate:modelValue":e[4]||(e[4]=i=>t.description=i),label:"\u5167\u6587",rules:[V.required]},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"9"},{default:s(()=>[l(P,{modelValue:t.image,"onUpdate:modelValue":e[5]||(e[5]=i=>t.image=i),"show-size":"",accept:"image/*",label:"\u5716\u7247","prepend-icon":"mdi-image",outlined:"",rules:[V.size]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),l(S,null,{default:s(()=>[l(m,{class:"justify-center"},{default:s(()=>[l(p,{type:"submit",color:"primary",loading:t.submitting},{default:s(()=>[se]),_:1},8,["loading"]),l(p,{color:"error",onClick:e[6]||(e[6]=i=>t.dialog=!1),disabled:t.submitting},{default:s(()=>[ie]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"])]))}};export{xe as default};
