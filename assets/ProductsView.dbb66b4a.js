import{i as V,o as u,c,a as l,w as a,V as m,bg as h,S as f,g as n,ab as g,A as y,b as i,F as j,r as z,b9 as A,t as x,h as S,aa as _,e as T,f as k}from"./index.250fd50a.js";import{V as q}from"./VDialog.5f7210f9.js";import{V as B}from"./VTable.39f17847.js";import{V as D}from"./VForm.45f18be5.js";import{b as E,V as N,a as $,d as I}from"./VCard.428f1a8c.js";import{a as C}from"./VTextField.660273e8.js";import{V as P}from"./VCheckbox.751d4af0.js";import{V as L}from"./VSelect.f9e32e2e.js";import{V as M,a as R}from"./VTextarea.b855deee.js";import"./scopeId.e974f990.js";import"./form.376311bc.js";import"./VOverlay.30f78188.js";import"./createSimpleFunctional.e4f50c27.js";import"./VAvatar.87710db4.js";import"./VCheckboxBtn.94e17887.js";import"./VList.527cabe8.js";import"./VDivider.1e0f23d4.js";const G={id:"admin-products"},H=i("h1",{class:"text-center my-2"},"\u5546\u54C1\u7BA1\u7406",-1),J=_("mdi-plus"),K=i("thead",null,[i("tr",null,[i("th",{class:"text-center text-h6"},"\u7DE8\u865F"),i("th",{class:"text-center text-h6"},"\u5716\u7247"),i("th",{class:"text-center text-h6"},"\u540D\u7A31"),i("th",{class:"text-center text-h6"},"\u7A2E\u985E"),i("th",{class:"text-center text-h6"},"\u4E0A\u67B6"),i("th",{class:"text-center text-h6"},"\u7DE8\u8F2F"),i("th",{class:"text-center text-h6"},"\u522A\u9664")])],-1),O={class:"text-center"},Q={class:"text-center"},W={class:"text-center"},X={key:0,class:"text-center"},Y={key:1,class:"text-center"},Z=_("mdi-pencil-outline"),ee=_("mdi-delete"),te={key:1},le=i("td",{class:"text-center text-h6",colspan:"7"},"\u5C1A\u7121\u5546\u54C1",-1),se=[le],ae={class:"text-h5"},oe=_("\u78BA\u5B9A"),ie=_("\u53D6\u6D88"),Ue={__name:"ProductsView",setup(re){const v=V(["\u6D17\u9AEE\u7CFB\u5217","\u8B77\u9AEE\u7CFB\u5217","\u9020\u578B\u68B3","\u9020\u578B\u593E","\u96FB\u6372\u68D2","\u5439\u98A8\u6A5F"]),r=V([]),t=V({_id:"",name:"",price:0,sell:!1,category:"",image:"",description:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),p=V({required(o){return!!o||"\u5FC5\u586B"},price(o){return o>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(o){var e,s,d;return!o||!o.length||((s=(e=o[0])==null?void 0:e.type)==null?void 0:s.includes("image"))&&((d=o[0])==null?void 0:d.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),b=(o,e)=>{t._id=o,e>-1?(t.name=r[e].name,t.price=r[e].price,t.sell=r[e].sell,t.category=r[e].category,t.description=r[e].description):(t.name="",t.price=0,t.sell=!1,t.category="",t.description=""),t.image=[],t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},w=async()=>{if(!t.valid)return;t.submitting=!0;const o=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||(e==="image"?o.append(e,t[e][0]):o.append(e,t[e]));try{if(t._id.length===0){const{data:e}=await h.post("/products",o);r.push(e.result),f.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await h.patch("/products/"+t._id,o);console.log(o.name),r[t.idx]=e.result,f.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){f.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1},U=async(o,e)=>{try{if(o.length!==0){const{data:s}=await h.delete("/products/"+o);r.splice(e,1),f.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"})}}catch(s){f.fire({icon:"error",title:"\u5931\u6557",text:s.isAxiosError?s.response.data.message:s.message})}};return(async()=>{try{const{data:o}=await h.get("/products/all");r.push(...o.result)}catch(o){console.log(o),f.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError?o.response.data.message:o.message})}})(),(o,e)=>(u(),c("div",G,[l(m,{class:"justify-center"},{default:a(()=>[l(n,{cols:"9"},{default:a(()=>[H]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(m,{class:"justify-end align-center",style:{height:"150px"}},{default:a(()=>[l(g,{icon:"",variant:"text",onClick:e[0]||(e[0]=s=>b("",-1))},{default:a(()=>[l(y,{color:"green lighten-2"},{default:a(()=>[J]),_:1})]),_:1})]),_:1})]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(B,null,{default:a(()=>[K,i("tbody",null,[r.length>0?(u(!0),c(j,{key:0},z(r,(s,d)=>(u(),c("tr",{key:s._id},[i("td",O,x(d+1),1),i("td",null,[l(T,{src:s.image},null,8,["src"])]),i("td",Q,x(s.name),1),i("td",W,x(s.category),1),s.sell===!0?(u(),c("td",X,"\u5DF2\u4E0A\u67B6")):k("",!0),s.sell===!1?(u(),c("td",Y,"\u672A\u4E0A\u67B6")):k("",!0),i("td",null,[l(m,{class:"justify-center"},{default:a(()=>[l(g,{onClick:F=>b(s._id,d),style:{width:"2rem",height:"2rem"},icon:"",variant:"text"},{default:a(()=>[l(y,{style:{"font-size":"large"},color:"blue lighten-2"},{default:a(()=>[Z]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),i("td",null,[l(m,{class:"justify-center align-center"},{default:a(()=>[l(g,{onClick:F=>U(s._id,d),style:{width:"2rem",height:"2rem"},icon:"",variant:"text"},{default:a(()=>[l(y,{style:{"font-size":"large"},color:"red lighten-2"},{default:a(()=>[ee]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]))),128)):(u(),c("tr",te,se))])]),_:1})]),_:1})]),_:1}),l(q,{modelValue:t.dialog,"onUpdate:modelValue":e[9]||(e[9]=s=>t.dialog=s),persistent:""},{default:a(()=>[l(D,{modelValue:t.valid,"onUpdate:modelValue":e[8]||(e[8]=s=>t.valid=s),onSubmit:A(w,["prevent"])},{default:a(()=>[l(E,null,{default:a(()=>[l(N,{class:"text-center my-4"},{default:a(()=>[i("div",ae,x(t._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1)]),_:1}),l($,null,{default:a(()=>[l(S,null,{default:a(()=>[l(m,{class:"justify-center"},{default:a(()=>[l(n,{cols:"9"},{default:a(()=>[l(C,{modelValue:t.name,"onUpdate:modelValue":e[1]||(e[1]=s=>t.name=s),label:"\u540D\u7A31",rules:[p.required]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(C,{type:"number",min:"0",modelValue:t.price,"onUpdate:modelValue":e[2]||(e[2]=s=>t.price=s),label:"\u50F9\u683C",rules:[p.required,p.price]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(P,{modelValue:t.sell,"onUpdate:modelValue":e[3]||(e[3]=s=>t.sell=s),label:"\u4E0A\u67B6"},null,8,["modelValue"])]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(L,{items:v,modelValue:t.category,"onUpdate:modelValue":e[4]||(e[4]=s=>t.category=s),label:"\u5206\u985E",rules:[p.required]},null,8,["items","modelValue","rules"])]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(M,{modelValue:t.image,"onUpdate:modelValue":e[5]||(e[5]=s=>t.image=s),"show-size":"",accept:"image/*",label:"\u5546\u54C1\u5716\u7247","prepend-icon":"",outlined:"",rules:[p.size]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(R,{modelValue:t.description,"onUpdate:modelValue":e[6]||(e[6]=s=>t.description=s),label:"\u5546\u54C1\u4ECB\u7D39"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(I,null,{default:a(()=>[l(m,{class:"justify-center"},{default:a(()=>[l(g,{type:"submit",color:"primary",loading:t.submitting},{default:a(()=>[oe]),_:1},8,["loading"]),l(g,{color:"error",onClick:e[7]||(e[7]=s=>t.dialog=!1),disabled:t.submitting},{default:a(()=>[ie]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"])]))}};export{Ue as default};
