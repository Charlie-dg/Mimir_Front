import{r as V,o as u,c,a as l,w as a,V as m,be as x,S as f,d as n,K as p,Y as h,g as i,F as z,e as F,bc as S,h as T,k as q,t as y,q as A,l as $,W as B,U as g,i as D,bk as k}from"./index.1082d962.js";import{V as E}from"./VDialog.e4763950.js";import{V as N}from"./VTable.817ea64e.js";import{V as I}from"./VForm.89f02d49.js";import{V as v}from"./VTextField.00a589dd.js";import{V as P}from"./VCheckbox.ff7d9415.js";import{V as K}from"./VSelect.2771230d.js";import{a as L,V as M}from"./VTextarea.6833b76b.js";import"./scopeId.cbed2b8d.js";import"./easing.1a8f6470.js";import"./form.61b6348e.js";import"./VOverlay.1f392678.js";import"./VChip.6686a241.js";import"./VList.e5155c36.js";const R={id:"admin-products"},W=i("h1",{class:"text-center my-2"},"\u5546\u54C1\u7BA1\u7406",-1),Y=g("mdi-plus"),G=i("thead",null,[i("tr",null,[i("th",{class:"text-center text-h6"},"\u7DE8\u865F"),i("th",{class:"text-center text-h6"},"\u5716\u7247"),i("th",{class:"text-center text-h6"},"\u540D\u7A31"),i("th",{class:"text-center text-h6"},"\u7A2E\u985E"),i("th",{class:"text-center text-h6"},"\u4E0A\u67B6"),i("th",{class:"text-center text-h6"},"\u7DE8\u8F2F"),i("th",{class:"text-center text-h6"},"\u522A\u9664")])],-1),H={class:"text-center"},J={class:"text-center"},O={class:"text-center"},Q={key:0,class:"text-center"},X={key:1,class:"text-center"},Z=g("mdi-pencil-outline"),ee=g("mdi-delete"),te={key:1},le=i("td",{class:"text-center text-h6",colspan:"7"},"\u5C1A\u7121\u5546\u54C1",-1),se=[le],ae=g("mdi-close"),oe={class:"text-h5"},ie=g("\u78BA\u5B9A"),re=g("\u53D6\u6D88"),Ce={__name:"ProductsView",setup(ne){const C=V(["\u6D17\u9AEE\u7CFB\u5217","\u8B77\u9AEE\u7CFB\u5217","\u9020\u578B\u68B3","\u9020\u578B\u593E","\u96FB\u6372\u68D2","\u5439\u98A8\u6A5F"]),r=V([]),t=V({_id:"",name:"",price:0,sell:!1,category:"",image:"",description:"",idx:-1,dialog:!1,valid:!1,submitting:!1}),_=V({required(o){return!!o||"\u5FC5\u586B"},price(o){return o>-1||"\u5FC5\u9808\u5927\u65BC\u7B49\u65BC 0"},size(o){var e,s,d;return!o||!o.length||((s=(e=o[0])==null?void 0:e.type)==null?void 0:s.includes("image"))&&((d=o[0])==null?void 0:d.size)<1024*1024||"\u6A94\u6848\u683C\u5F0F\u4E0D\u7B26"}}),b=(o,e)=>{t._id=o,e>-1?(t.name=r[e].name,t.price=r[e].price,t.sell=r[e].sell,t.category=r[e].category,t.description=r[e].description):(t.name="",t.price=0,t.sell=!1,t.category="",t.description=""),t.image=[],t.idx=e,t.dialog=!0,t.valid=!1,t.submitting=!1},w=async()=>{if(!t.valid)return;t.submitting=!0;const o=new FormData;for(const e in t)["_id","idx","dialog","valid","submitting"].includes(e)||(e==="image"?o.append(e,t[e][0]):o.append(e,t[e]));try{if(t._id.length===0){const{data:e}=await x.post("/products",o);r.push(e.result),f.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:e}=await x.patch("/products/"+t._id,o);console.log(o.name),r[t.idx]=e.result,f.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}t.dialog=!1}catch(e){f.fire({icon:"error",title:"\u5931\u6557",text:e.isAxiosError?e.response.data.message:e.message})}t.submitting=!1},U=async(o,e)=>{try{if(o.length!==0){const{data:s}=await x.delete("/products/"+o);r.splice(e,1),f.fire({icon:"success",title:"\u6210\u529F",text:"\u522A\u9664\u6210\u529F"})}}catch(s){f.fire({icon:"error",title:"\u5931\u6557",text:s.isAxiosError?s.response.data.message:s.message})}};return(async()=>{try{const{data:o}=await x.get("/products/all");r.push(...o.result)}catch(o){console.log(o),f.fire({icon:"error",title:"\u5931\u6557",text:o.isAxiosError?o.response.data.message:o.message})}})(),(o,e)=>(u(),c("div",R,[l(m,{class:"justify-center"},{default:a(()=>[l(n,{cols:"9"},{default:a(()=>[W]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(m,{class:"justify-end align-center",style:{height:"150px"}},{default:a(()=>[l(p,{icon:"",variant:"text",onClick:e[0]||(e[0]=s=>b("",-1))},{default:a(()=>[l(h,{color:"green lighten-2"},{default:a(()=>[Y]),_:1})]),_:1})]),_:1})]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(N,null,{default:a(()=>[G,i("tbody",null,[r.length>0?(u(!0),c(z,{key:0},F(r,(s,d)=>(u(),c("tr",{key:s._id},[i("td",H,y(d+1),1),i("td",null,[l(D,{src:s.image},null,8,["src"])]),i("td",J,y(s.name),1),i("td",O,y(s.category),1),s.sell===!0?(u(),c("td",Q,"\u5DF2\u4E0A\u67B6")):k("",!0),s.sell===!1?(u(),c("td",X,"\u672A\u4E0A\u67B6")):k("",!0),i("td",null,[l(m,{class:"justify-center"},{default:a(()=>[l(p,{onClick:j=>b(s._id,d),style:{width:"2rem",height:"2rem"},icon:"",variant:"text"},{default:a(()=>[l(h,{style:{"font-size":"large"},color:"blue lighten-2"},{default:a(()=>[Z]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),i("td",null,[l(m,{class:"justify-center align-center"},{default:a(()=>[l(p,{onClick:j=>U(s._id,d),style:{width:"2rem",height:"2rem"},icon:"",variant:"text"},{default:a(()=>[l(h,{style:{"font-size":"large"},color:"red lighten-2"},{default:a(()=>[ee]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]))),128)):(u(),c("tr",te,se))])]),_:1})]),_:1})]),_:1}),l(E,{modelValue:t.dialog,"onUpdate:modelValue":e[10]||(e[10]=s=>t.dialog=s),persistent:""},{default:a(()=>[l(I,{class:"overflow-auto",modelValue:t.valid,"onUpdate:modelValue":e[9]||(e[9]=s=>t.valid=s),onSubmit:S(w,["prevent"])},{default:a(()=>[l(T,null,{default:a(()=>[l(n,{class:"d-flex justify-end"},{default:a(()=>[l(p,{icon:"",variant:"text",size:"x-small",onClick:e[1]||(e[1]=s=>t.dialog=!1)},{default:a(()=>[l(h,null,{default:a(()=>[ae]),_:1})]),_:1})]),_:1}),l(q,{class:"text-center my-4"},{default:a(()=>[i("div",oe,y(t._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1)]),_:1}),l(A,null,{default:a(()=>[l($,null,{default:a(()=>[l(m,{class:"justify-center"},{default:a(()=>[l(n,{cols:"9"},{default:a(()=>[l(v,{modelValue:t.name,"onUpdate:modelValue":e[2]||(e[2]=s=>t.name=s),label:"\u540D\u7A31",rules:[_.required]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(v,{type:"number",min:"0",modelValue:t.price,"onUpdate:modelValue":e[3]||(e[3]=s=>t.price=s),label:"\u50F9\u683C",rules:[_.required,_.price]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(P,{modelValue:t.sell,"onUpdate:modelValue":e[4]||(e[4]=s=>t.sell=s),label:"\u4E0A\u67B6"},null,8,["modelValue"])]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(K,{items:C,modelValue:t.category,"onUpdate:modelValue":e[5]||(e[5]=s=>t.category=s),label:"\u5206\u985E",rules:[_.required]},null,8,["items","modelValue","rules"])]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(L,{modelValue:t.image,"onUpdate:modelValue":e[6]||(e[6]=s=>t.image=s),"show-size":"",accept:"image/*",label:"\u5546\u54C1\u5716\u7247","prepend-icon":"mdi-image",outlined:"",rules:[_.size]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"9"},{default:a(()=>[l(M,{modelValue:t.description,"onUpdate:modelValue":e[7]||(e[7]=s=>t.description=s),label:"\u5546\u54C1\u4ECB\u7D39"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(B,null,{default:a(()=>[l(m,{class:"justify-center"},{default:a(()=>[l(p,{type:"submit",color:"primary",loading:t.submitting},{default:a(()=>[ie]),_:1},8,["loading"]),l(p,{color:"error",onClick:e[8]||(e[8]=s=>t.dialog=!1),disabled:t.submitting},{default:a(()=>[re]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"])]))}};export{Ce as default};
